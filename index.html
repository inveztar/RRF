<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Resonance Watch — หาเรโซแนนซ์จากไมค์จริง</title>
<style>
  :root{
    --bg:#121a22;--panel:#18222c;--panel-2:#111922;--soft:#0f1722;
    --text:#d9e7ff;--muted:#98a7b8;--accent:#27c1ff;--accent-2:#5de3ff;
    --ok:#63e6be;--warn:#ffd166;--danger:#ff7676;--line:#253341;
    --chip:#15b5ff;--chip-t:#00121d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1280px;margin:auto;padding:22px}

  h2{margin:0 0 12px;font-weight:800;letter-spacing:.2px}
  section{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin:16px 0}

  /* ---------- SCORE BOARD (อัปเดต v2.2) ---------- */
  .score-grid{
    display:grid;grid-template-columns:repeat(3,1fr);gap:14px
  }
  .score-card{
    background:var(--panel-2);
    border:1px solid var(--line);
    border-radius:14px;
    padding:14px 14px 12px;
    min-height:168px;           /* ความสูงคงที่ ไม่เด้ง */
    display:flex;flex-direction:column;justify-content:space-between
  }
  .hz-line{
    display:flex;align-items:center;gap:10px;margin-bottom:6px
  }
  .hz{
    font-size:22px;font-weight:800;letter-spacing:.5px;white-space:nowrap
  }
  .note-chip{
    background:var(--chip);
    color:var(--chip-t);
    font-weight:900;
    padding:6px 12px;border-radius:999px;
    font-size:14px;min-width:64px;text-align:center
  }
  .mark{
    margin-left:auto;
    background:#0f2a3a;color:#cde8ff;
    padding:6px 12px;border-radius:999px;
    font-size:13px
  }

  .score-num{
    font-size:40px;font-weight:900;letter-spacing:2px;margin:2px 0 8px
  }

  /* gradient pill + shadow */
  .bar-wrap{
    position:relative;height:14px;border-radius:999px;
    background:#0c141d;border:1px solid #1f2a37;
    box-shadow:inset 0 1px 1.5px rgba(255,255,255,.05), inset 0 8px 14px rgba(0,0,0,.35);
    overflow:hidden
  }
  .bar{
    height:100%;width:0%;
    background:linear-gradient(90deg,#57d2ff 0%,#a6d9ff 50%,#ff9fb2 100%);
    border-radius:999px;
    box-shadow:0 6px 14px rgba(95,227,255,.25),0 2px 6px rgba(255,159,178,.3);
    transition:width .36s ease;       /* ลื่น ไม่ไว/หน่วงเกินไป */
  }

  /* แถวเปอร์เซ็นต์องค์ประกอบ (ย่อเล็กลง) */
  .comp{
    display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);
    font-size:13px;margin-top:8px;letter-spacing:.2px
  }

  /* คำอธิบายเล็กลง (อ่านสบายบนมือถือ) */
  .score-note{
    color:var(--muted);font-size:15px;line-height:1.55;margin-top:12px
  }

  /* placeholder ค่าที่ไม่มี */
  .placeholder{opacity:.55}

  /* mobile */
  @media (max-width:980px){
    .wrap{padding:16px}
    .score-grid{grid-template-columns:1fr;gap:12px}
    .score-card{min-height:152px}
    .hz{font-size:20px}
    .note-chip{font-size:13px;padding:5px 10px}
    .score-num{font-size:36px}
    .comp{font-size:12.5px}
    .score-note{font-size:14px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <section>
      <h2>Resonance Likelihood (Score)</h2>

      <!-- 3 กล่องคงที่เสมอ (— เมื่อยังไม่มีค่า) -->
      <div class="score-grid" id="scoreGrid">
        <!-- card 1 -->
        <div class="score-card" id="card-0">
          <div>
            <div class="hz-line">
              <div class="hz"><span class="f">—</span> Hz</div>
              <span class="note-chip"><span class="n">—</span></span>
              <span class="mark" id="badge-0">—</span>
            </div>
            <div class="score-num"><span class="s">—</span></div>
            <div class="bar-wrap"><div class="bar"></div></div>
            <div class="comp">
              <span class="p">P:—</span> •
              <span class="h">H:—</span> •
              <span class="c">C:—</span> •
              <span class="d">D:—</span>
            </div>
          </div>
        </div>
        <!-- card 2 -->
        <div class="score-card" id="card-1">
          <div>
            <div class="hz-line">
              <div class="hz"><span class="f">—</span> Hz</div>
              <span class="note-chip"><span class="n">—</span></span>
              <span class="mark" id="badge-1">—</span>
            </div>
            <div class="score-num"><span class="s">—</span></div>
            <div class="bar-wrap"><div class="bar"></div></div>
            <div class="comp">
              <span class="p">P:—</span> •
              <span class="h">H:—</span> •
              <span class="c">C:—</span> •
              <span class="d">D:—</span>
            </div>
          </div>
        </div>
        <!-- card 3 -->
        <div class="score-card" id="card-2">
          <div>
            <div class="hz-line">
              <div class="hz"><span class="f">—</span> Hz</div>
              <span class="note-chip"><span class="n">—</span></span>
              <span class="mark" id="badge-2">—</span>
            </div>
            <div class="score-num"><span class="s">—</span></div>
            <div class="bar-wrap"><div class="bar"></div></div>
            <div class="comp">
              <span class="p">P:—</span> •
              <span class="h">H:—</span> •
              <span class="c">C:—</span> •
              <span class="d">D:—</span>
            </div>
          </div>
        </div>
      </div>

      <p class="score-note">
        คะแนนคำนวณจาก Prominence (0–12dB), Hold (0–3s), Count (เทียบกับอันดับสูงสุด), Decay (0–1.5s)
        — ถ่วงน้ำหนัก 30/30/20/20 ผลลัพธ์ขึ้นกับไมค์และสภาพแวดล้อม แนะนำใช้ร่วมกับการลองปรับ EQ/ยืนตำแหน่งใน room mode
      </p>
    </section>
  </div>

<script>
/* ============================================================
   UPDATE v2.2
   - ทำการ์ดคงที่ 3 ใบ, placeholder '—' เมื่อยังไม่มีข้อมูล
   - ย่อฟอนต์, ลด %P/H/C/D, ปรับคำอธิบายให้เล็กลง
   - Score bar เป็น gradient pill + เงา และ transition .36s
   ============================================================ */

/* NOTE UTIL (คำนวณชื่อโน้ต) */
function hzToNoteName(hz){
  if(!hz || !isFinite(hz)) return "—";
  const A4=440, n=Math.round(12*Math.log2(hz/A4))+57; // C4=60
  const names=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const name=names[(n%12+12)%12], octave=Math.floor(n/12);
  return `${name}${octave}`;
}

/* ตัวอย่างข้อมูลจำลอง (คุณเสียบเข้ากับระบบเดิมได้ทันที) */
const demo = [
  {hz:293, score:89.0, p:71, h:100, c:100, d:27, badge:"เรโซแนนซ์"},
  {hz:199, score:61.9, p:33, h:100, c:16,  d:7,  badge:"น่าสงสัย"},
  {hz:152, score:58.2, p:74, h:69,  c:5,   d:13, badge:"น่าสงสัย"}
];

/* เติมข้อมูลลงการ์ด; หากส่ง null จะเป็น placeholder */
function fillCard(idx, data){
  const card = document.getElementById(`card-${idx}`);
  const f = card.querySelector('.f');
  const n = card.querySelector('.n');
  const s = card.querySelector('.s');
  const bar = card.querySelector('.bar');
  const p = card.querySelector('.p');
  const h = card.querySelector('.h');
  const c = card.querySelector('.c');
  const d = card.querySelector('.d');
  const badge = document.getElementById(`badge-${idx}`);

  if(!data){
    f.textContent = "—"; n.textContent="—"; s.textContent="—";
    p.textContent="P:—"; h.textContent="H:—"; c.textContent="C:—"; d.textContent="D:—";
    badge.textContent="—";
    bar.style.width="0%";
    card.classList.add('placeholder');
  }else{
    card.classList.remove('placeholder');
    f.textContent = Math.round(data.hz);
    n.textContent = hzToNoteName(data.hz);
    s.textContent = (Math.round(data.score*10)/10).toFixed(1);
    bar.style.width = Math.max(0, Math.min(100, data.score)) + "%";
    p.textContent=`P:${data.p}%`; h.textContent=`H:${data.h}%`; c.textContent=`C:${data.c}%`; d.textContent=`D:${data.d}%`;
    badge.textContent = data.badge || "—";
  }
}

/* แสดงผลเริ่มต้น: หากคุณมีระบบวิเคราะห์จริง ให้เรียก fillCard(…ข้อมูลจริง…) */
function renderDemo(){
  fillCard(0, demo[0]);
  fillCard(1, demo[1]);
  fillCard(2, demo[2]);
}
renderDemo();

/* export helper ให้ระบบเดิมเรียกใช้ได้
   window.updateScoreCards([{hz,score,p,h,c,d,badge}, ...3 รายการ]) */
window.updateScoreCards = (list=[])=>{
  for(let i=0;i<3;i++){
    fillCard(i, list[i] || null);
  }
};
</script>
</body>
</html>
