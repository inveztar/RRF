<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Resonance Watch – Likelihood Card Patch</title>
<style>
  :root{
    --bg:#0f1a24;
    --panel:#14212e;
    --muted:#9fb3c8;
    --text:#e9f1fa;
    --accent:#61dafb;
    --pill-a:#89f0ff; /* gradient start */
    --pill-b:#66d5ff; /* mid */
    --pill-c:#ff9ec4; /* gradient end */
    --track:#192938;
    --shadow:0 6px 22px rgba(102,213,255,.18), 0 1px 0 rgba(255,255,255,.04) inset;
  }

  html,body{background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Sans Thai",sans-serif;margin:0}
  .container{max-width:1160px;padding:16px 20px;margin:0 auto}
  h2{font-weight:700;letter-spacing:.2px;margin:0 0 12px 0}
  .muted{color:var(--muted)}

  /* ---------------- PATCHED CARD AREA ---------------- */
  .likelihood-wrap{
    background:var(--panel);
    border-radius:14px;
    padding:16px;
    box-shadow:0 1px 0 rgba(255,255,255,.03) inset, 0 12px 28px rgba(0,0,0,.35);
  }

  .cards{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:14px;
  }

  .card{
    background:#0f1c28;
    border:1px solid #1f3142;
    border-radius:14px;
    padding:14px 14px 12px;
    min-height:146px; /* keeps height even when '—' */
    position:relative;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
  }

  /* header row on one line: Hz (Note) • status */
  .hdr{
    display:flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    font-size:18px;
    line-height:1.2;
    margin-bottom:6px;
  }
  .hz{font-variation-settings:"wght" 650}
  .note-pill{
    font-size:13px;
    padding:2px 8px;
    border-radius:999px;
    background:#0ea5b0;
    color:#00121a;
    font-weight:700;
  }
  .state-pill{
    font-size:12px;
    padding:2px 8px;
    border-radius:999px;
    background:#0f2740;
    color:#b8e8ff;
    border:1px solid #184968;
  }

  .score{
    font-size:44px;
    font-weight:800;
    letter-spacing:.5px;
    margin:2px 0 8px;
  }

  /* gradient pill bar – always visible */
  .bar{
    width:100%;
    height:12px;
    border-radius:999px;
    background:var(--track);
    box-shadow:var(--shadow);
    position:relative;
    overflow:hidden;
  }
  .bar > .fill{
    position:absolute;left:0;top:0;bottom:0;
    width:0%;
    background:linear-gradient(90deg,var(--pill-a) 0%, var(--pill-b) 40%, var(--pill-c) 100%);
    border-radius:999px;
    transition:width .45s ease;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.18);
  }

  .meta{
    margin-top:8px;
    font-size:13px; /* smaller %P/H/C/D */
    color:var(--muted);
  }

  /* explanation paragraph smaller */
  .explain{
    margin-top:14px;
    font-size:14px;
    color:#b6c5d8;
    line-height:1.6;
  }

  /* placeholder look when no data but keep layout */
  .placeholder .score{opacity:.65}
  .placeholder .hdr .note-pill,
  .placeholder .hdr .state-pill{opacity:.6}

  /* responsive */
  @media(max-width:980px){
    .score{font-size:38px}
  }
  @media(max-width:720px){
    .cards{grid-template-columns:1fr}
    .score{font-size:36px}
    .hdr{font-size:17px}
    .meta{font-size:12px}
    .explain{font-size:13px}
  }

  /* small caption to mimic section title of the app */
  .section-title{font-size:18px;margin:4px 0 12px;color:#cfe8ff}
</style>
</head>
<body>
  <div class="container">
    <div class="likelihood-wrap">
      <div class="section-title">Resonance Likelihood (Score)</div>
      <div class="cards" id="scoreCards">
        <!-- 3 cards (always rendered, shows — if no data) -->
        <div class="card placeholder">
          <div class="hdr"><span class="hz">— Hz</span><span class="note-pill">(—)</span><span class="state-pill">—</span></div>
          <div class="score">—</div>
          <div class="bar"><div class="fill" style="width:0%"></div></div>
          <div class="meta">P:— • H:— • C:— • D:—</div>
        </div>
        <div class="card placeholder">
          <div class="hdr"><span class="hz">— Hz</span><span class="note-pill">(—)</span><span class="state-pill">—</span></div>
          <div class="score">—</div>
          <div class="bar"><div class="fill" style="width:0%"></div></div>
          <div class="meta">P:— • H:— • C:— • D:—</div>
        </div>
        <div class="card placeholder">
          <div class="hdr"><span class="hz">— Hz</span><span class="note-pill">(—)</span><span class="state-pill">—</span></div>
          <div class="score">—</div>
          <div class="bar"><div class="fill" style="width:0%"></div></div>
          <div class="meta">P:— • H:— • C:— • D:—</div>
        </div>
      </div>
      <div class="explain">
        คะแนนคำนวณจาก Prominence (0–12dB), Hold (0–3s), Count (เทียบกับอันดับสูงสุด), Decay (0–1.5s) —
        น้ำหนัก 30/30/20/20 — ผลลัพธ์ขึ้นกับไมค์และสภาพแวดล้อม แนะนำใช้ร่วมกับการลองปรับ EQ/ยืนตำแหน่ง room mode
      </div>
    </div>
  </div>

<script>
/* ------- PATCH API (สำหรับต่อหลังบ้าน) -------
   เรียก window.updateScoreCards([...3 รายการ]) โดยใส่ข้อมูลตามนี้:
   { hz:176, note:'F3', score:77.4, status:'เรโซแนนซ์', p:1.00, h:0.51, c:0.78, d:0.00 }
   หากส่งอาร์เรย์ไม่ครบ 3 รายการ ที่เหลือจะคงอยู่ในโหมด placeholder และไม่เด้ง
------------------------------------------------ */
(function(){
  const root = document.getElementById('scoreCards');

  function toPct(v){
    if (v==null || Number.isNaN(v)) return '—';
    return Math.round(v*100) + '%';
  }

  function renderCard(el, data){
    const hz = el.querySelector('.hz');
    const note = el.querySelector('.note-pill');
    const state = el.querySelector('.state-pill');
    const score = el.querySelector('.score');
    const fill  = el.querySelector('.fill');
    const meta  = el.querySelector('.meta');
    if(!data){
      el.classList.add('placeholder');
      hz.textContent = '— Hz';
      note.textContent = '(—)';
      state.textContent = '—';
      score.textContent = '—';
      fill.style.width = '0%';
      meta.textContent = 'P:— • H:— • C:— • D:—';
      return;
    }
    el.classList.remove('placeholder');
    hz.textContent = (Math.round((data.hz ?? 0)*10)/10) + ' Hz';
    note.textContent = '(' + (data.note || '—') + ')';
    state.textContent = data.status || 'น่าสงสัย';
    score.textContent = (data.score!=null? (Math.round(data.score*10)/10) : '—');
    const width = Math.max(0, Math.min(100, data.score || 0));
    fill.style.width = width + '%';
    meta.textContent = `P:${toPct(data.p)} • H:${toPct(data.h)} • C:${toPct(data.c)} • D:${toPct(data.d)}`;
  }

  window.updateScoreCards = function(list){
    const cards = Array.from(root.querySelectorAll('.card'));
    for(let i=0;i<3;i++){
      renderCard(cards[i], list && list[i]);
    }
  };

  // Demo data (ลบทิ้งได้) – เพื่อเห็นหน้าตา (สามารถกดรันในไฟล์เปิดเดี่ยว)
  const demo = [
    {hz:293, note:'D4', score:89.0, status:'เรโซแนนซ์', p:.71, h:1, c:1, d:.27},
    {hz:199, note:'G3', score:61.9, status:'น่าสงสัย', p:.33, h:1, c:.16, d:.07},
    {hz:152, note:'D#3', score:58.2, status:'น่าสงสัย', p:.74, h:.69, c:.05, d:.13}
  ];
  updateScoreCards(demo);
})();
</script>
</body>
</html>
